#VRML V2.0 utf8

# ============================================================================
# KUKA KR4 R600 6-Axis Robot Arm - Interactive 3D Model
# ============================================================================
# This file contains a fully articulated robot model with:
# - Bidirectional control: sliders AND direct 3D interaction
# - Sensors enabled with JavaScript sync for seamless operation
# - Custom calibrated viewpoints
# - Modular PROTO definitions for reusability
# - 5° safety margins on all axis limits
# - 5° safety margins on all axis limits
# ============================================================================

# Ground Plane PROTO for spatial reference
PROTO GroundPlane [
  field SFVec2f size 2000 2000
  field SFVec2f subdivisions 20 20
]{
  Transform {
    translation 0 0 -400 # Matches robot base depth 
    children [
      Shape {
        appearance Appearance {
          material Material { diffuseColor 0.2 0.2 0.2 }
        }
        geometry IndexedFaceSet {
          coord Coordinate {
            point [ -1000 -1000 0, 1000 -1000 0, 1000 1000 0, -1000 1000 0 ]
          }
          coordIndex [ 0 1 2 3 -1 ]
          solid FALSE
        }
      }
      # Grid Lines
      Shape {
        geometry IndexedLineSet {
          color Color { color [ 0.4 0.4 0.4 ] }
          coord Coordinate {
            point [ 
              -1000 -1000 0.1, 1000 -1000 0.1, 1000 1000 0.1, -1000 1000 0.1,
              0 -1000 0.1, 0 1000 0.1, -1000 0 0.1, 1000 0 0.1
            ]
          }
          coordIndex [ 0 1 2 3 0 -1, 4 5 -1, 6 7 -1 ]
        }
      }
    ]
  }
}

# Coordinate system PROTO for joint visualization
PROTO coSys [
  exposedField SFVec3f scale 200 200 200
]{
  Collision {
    collide FALSE
    children [
      Transform {
        scale IS scale
        children [
          Shape {
            geometry IndexedLineSet {
              color Color { color [ .5 0 0  0 .5 0  0 0 .5  1 0 0  0 1 0  0 0 1  1 1 1 0 0 0] }
              coord Coordinate {
                point [
                  0 0 0
                  -1 0 0
                  0 -1 0
                  0 0 -1
                  1 0 0
                  0 1 0
                  0 0 1
                ]
              }
              coordIndex [ 0 1 -1  0 2 -1  0 3 -1  0 4 -1  0 5 -1  0 6 -1 ]
              colorPerVertex FALSE
            }
          }
        ]
      }
    ]
  }
}

# SCHUNK Gripper PROTO - End effector gripper model
PROTO SchunkGripper [
  exposedField SFVec3f translation 0 0 0
  exposedField SFRotation rotation 0 1 0 0
  exposedField SFVec3f scale 1 1 1
  exposedField MFNode children []
]{
  Transform {
    translation IS translation
    rotation IS rotation
    scale IS scale
    children [
      Inline { 
        url ["SCHUNK-0310940 EGP 40-N-N-B, 00ohne.wrl"]
      }
      Group {
        children IS children
      }
    ]
  }
}

# Finger PROTO - Gripper finger model
PROTO GripperFinger [
  exposedField SFVec3f translation 0 0 0
  exposedField SFRotation rotation 0 1 0 0
  exposedField SFVec3f scale 1 1 1
]{
  Transform {
    translation IS translation
    rotation IS rotation
    scale IS scale
    children [
      Inline { 
        url ["prizmfinger.wrl"]
      }
    ]
  }
}

# Adapter Flange to Gripper PROTO - End effector adapter
PROTO AdapterFlanch2gripper [
  exposedField SFVec3f translation 0 0 0
  exposedField SFRotation rotation 0 1 0 0
  exposedField SFVec3f scale 1 1 1
  exposedField MFNode children []
]{
  Transform {
    translation IS translation
    rotation IS rotation
    scale IS scale
    children [
      Inline { 
        url ["AdapterFlanch2gripper.wrl"]
      }
      Group {
        children IS children
      }
    ]
  }
}

# RobotJoint PROTO - Modular joint with position, orientation, geometry, sensor, and nesting
PROTO RobotJoint [
  exposedField SFString jointName ""          # Joint identifier (e.g., "J1", "J2")
  exposedField SFVec3f translation 0 0 0      # Position relative to parent
  exposedField SFRotation rotation 0 1 0 0    # Orientation of joint
  exposedField MFString geometryUrl []        # Geometry file to load
  exposedField SFVec3f geometryOffset 0 0 0   # Offset for geometry (to adjust rotation pivot)
  exposedField SFFloat jointLength 0          # Length parameter (for reference/documentation)
  exposedField SFBool hasSensor FALSE         # Enable/disable interactive sensor
  exposedField SFFloat minAngle -3.14159      # Minimum rotation angle (radians)
  exposedField SFFloat maxAngle 3.14159       # Maximum rotation angle (radians)
  exposedField SFBool showCoSys FALSE         # Show coordinate system
  exposedField SFVec3f coSysScale 100 100 100 # Coordinate system scale
  exposedField MFNode children []             # Nested child joints (enables recursion)
  eventOut SFRotation rotation_changed        # Sensor rotation output
  eventOut SFBool isOver_changed              # TouchSensor hover output
  eventIn SFRotation set_rotation             # Transform rotation input
]{
  Group {
    children [
      DEF JointTransform Transform {
        translation IS translation
        rotation IS rotation
        set_rotation IS set_rotation
        children [
          # Sensor (only active if hasSensor is TRUE)
          DEF JointSensor CylinderSensor {
            enabled IS hasSensor
            autoOffset TRUE
            minAngle IS minAngle
            maxAngle IS maxAngle
            diskAngle 0.262
            rotation_changed IS rotation_changed
          }
          
          # TouchSensor for hover detection
          DEF JointTouchSensor TouchSensor {
            enabled TRUE
            isOver IS isOver_changed
          }
          
          # Geometry with collision detection (with optional offset)
          Transform {
            translation IS geometryOffset
            children [
              Collision {
                collide TRUE
                children [
                  Inline { url IS geometryUrl }
                ]
              }
            ]
          }
          
          # Optional coordinate system visualization
          DEF CoSysNode Switch {
            whichChoice 0
            choice [
              coSys { scale IS coSysScale }
            ]
          }
          
          # Nested children (enables hierarchical structure and recursion)
          Group {
            children IS children
          }
        ]
      }
    ]
  }
  ROUTE JointSensor.rotation_changed TO JointTransform.set_rotation
}

# ============================================================================
# PROTO: AxisConverter - Converts joint rotation to specified axis
# ============================================================================
# Reusable script for converting CylinderSensor output to different rotation axes
PROTO AxisConverter [
  field SFVec3f axis 0 1 0  # Rotation axis (0 1 0 for Y, 1 0 0 for X, 0 0 1 for Z)
  eventIn SFRotation rotation_in
  eventOut SFRotation rotation_out
]{
  Script {
    field SFVec3f conversionAxis IS axis
    eventIn SFRotation rotation_in IS rotation_in
    eventOut SFRotation rotation_out IS rotation_out
    url "javascript:
      function rotation_in(value, time) {
        rotation_out[0] = conversionAxis[0];
        rotation_out[1] = conversionAxis[1];
        rotation_out[2] = conversionAxis[2];
        rotation_out[3] = value[3];
      }
    "
  }
}

# ============================================================================
# PROTO: CollisionSensor - Proximity-based collision avoidance for fingers
# ============================================================================
# Monitors proximity to objects and alerts when too close to robot parts or floor
PROTO CollisionSensor [
  exposedField SFVec3f translation 0 0 0
  exposedField SFVec3f center 0 0 0
  exposedField SFVec3f size 100 100 100
  eventOut SFBool isColliding
]{
  Group {
    children [
      DEF CollisionProx ProximitySensor {
        center IS center
        size IS size
      }
      Transform {
        translation IS translation
        children [
          # Visual indicator for collision zone (semi-transparent sphere)
          Shape {
            appearance Appearance {
              material Material {
                diffuseColor 1 0.3 0.3
                transparency 0.85
                emissiveColor 0.3 0 0
              }
            }
            geometry Sphere { radius 30 }
          }
        ]
      }
      DEF CollisionScript Script {
        eventIn SFVec3f position_in
        eventIn SFRotation orientation_in
        eventOut SFBool isColliding IS isColliding
        field SFFloat minFloorDistance 50.0
        field SFBool collisionState FALSE
        url "javascript:
          function position_in(value, time) {
            // Check if finger is too close to floor (Z < minFloorDistance)
            if (value[2] < minFloorDistance + (-400)) {
              if (!collisionState) {
                collisionState = true;
                isColliding = true;
              }
            } else if (collisionState) {
              collisionState = false;
              isColliding = false;
            }
          }
        "
      }
    ]
  }
  ROUTE CollisionProx.position_changed TO CollisionScript.position_in
  ROUTE CollisionProx.orientation_changed TO CollisionScript.orientation_in
}

# ============================================================================
# Robot Assembly Configuration
# ============================================================================
# KUKA KR4 R600 6-Axis Industrial Manipulator
# Final joint transforms:
#   A_base: 0 0 0
#   A1:     0 0 187.2    (Base swivel - Z-axis rotation)
#   A2:     0 0 140.9    (Shoulder - Y-axis rotation, HOME=-90°)
#   A3:     0 0 289.6    (Elbow - Y-axis rotation, HOME=+90°)
#   A4:     173 0 20     (Wrist rotation - X-axis rotation)
#   A5:     135.5 0 0    (Wrist roll - Y-axis rotation)
#   A6:     57.06 0 0    (End effector - X-axis rotation)
#
# Note: A2 and A3 minAngle/maxAngle are adjusted for HOME offsets:
#   A2 WRL limits: -100° to +125° (slider shows -190° to +35°)
#   A3 WRL limits: -200° to +55° (slider shows -110° to +145°)

# Axis converters for non-standard rotation axes
DEF A1_AxisConverter AxisConverter { axis 0 0 1 }  # Z-axis for base swivel
DEF A4_AxisConverter AxisConverter { axis 1 0 0 }  # X-axis for wrist rotation
DEF A6_AxisConverter AxisConverter { axis 1 0 0 }  # X-axis for end effector

Group {
  children [
    WorldInfo { 
      title "KUKA KR4 R600 6-Axis Robot Arm Assembly"
      info [
        "KUKA KR4 R600 Industrial Robot - Interactive Digital Twin"
        "Author: Sanath"
        "Created: December 2025 - January 2026"
        ""
        "=== Robot Specifications ==="
        "Model: KUKA KR4 R600"
        "Type: 6-axis articulated industrial robot"
        ""
        "=== Axis Configuration (Display Values) ==="
        "A1 (Base Swivel):      ±165° (Z-axis rotation)"
        "A2 (Shoulder):         -190° to +35° (Y-axis rotation, HOME=-90°)"
        "A3 (Elbow):            -110° to +145° (Y-axis rotation, HOME=+90°)"
        "A4 (Wrist Rotation):   ±180° (X-axis rotation)"
        "A5 (Wrist Roll):       ±115° (Y-axis rotation)"
        "A6 (End Effector):     ±345° (X-axis rotation)"
        ""
        "=== Actual Rotation Ranges (in WRL) ==="
        "A1: ±165° (±2.880 rad)"
        "A2: -100° to +125° (-1.745 to +2.182 rad) - accounts for HOME offset"
        "A3: -200° to +55° (-3.491 to +0.960 rad) - accounts for HOME offset"
        "A4: ±180° (±3.142 rad)"
        "A5: ±115° (±2.007 rad)"
        "A6: ±345° (±6.021 rad)"
        ""
        "=== Safety Features ==="
        "All axis limits include 5° safety margin from mechanical limits"
        "Bidirectional control: Both sliders AND direct 3D interaction enabled"
        "Sensors (hasSensor TRUE) with synchronized slider updates"
        "HOME offsets properly accounted in WRL limits for A2 and A3"
        ""
        "=== HOME Position ==="
        "A1 = 0°, A2 = -90°, A3 = +90°, A4 = 0°, A5 = 0°, A6 = 0°"
        "Note: A2 and A3 have non-zero HOME due to geometric modeling"
        ""
        "=== Technical Implementation ==="
        "Modular RobotJoint PROTO with hierarchical nesting"
        "Axis converters for non-standard rotation axes (A1, A4, A6)"
        "Coordinate system visualization for debugging"
        "Robot centered at origin (translation 0 0 -400) for natural examine mode"
        "Bidirectional sync via X_ITE addFieldCallback on rotation field"
        "Slider values clamped to safety limits even when using 3D interaction"
        ""
        "=== Files ==="
        "Main Model: K_R_r600_ProtoRfct_(Sanath).wrl"
        "Controller: sliderControl4X3D(Sanath).js"
        "Interface: KR4R600digiTwin(Sanath).html"
        "Geometry: KR_4_R600_V01_X_T_base.wrl, KR_4_R600_V01_X_T_0-5.wrl"
        ""
        "=== Features ==="
        "Interactive sliders with real-time 3D updates"
        "Direct 3D manipulation with automatic slider synchronization"
        "Multiple named configuration save/load (localStorage)"
        "JSON import/export for configuration sharing"
        "Smooth animations with ease-in-out transitions"
        "Reset to HOME position with 1-second animation"
        "Static instance management for all axes"
        ""
        "=== Usage ==="
        "Serve via HTTP server (e.g., python -m http.server 8000)"
        "Open KR4R600digiTwin(Sanath).html in X3D-compatible browser"
        "Control via sliders OR direct 3D drag-and-rotate interaction"
        "Both control methods respect 5° safety margins"
        "Save/load robot poses with custom names"
        ""
        "=== Known Issues ==="
        "Initial 3D interaction may not sync to sliders until after first slider use"
        "Workaround: Move any slider once to activate bidirectional sync"
      ]
    }
    
    Background { skyColor 0.1 0.1 0.1 }
    
    # Lighting for depth
    DirectionalLight { direction -1 -1 -1 intensity 1.0 }
    PointLight { location 0 1000 500 intensity 0.8 }

    # Ground Plane
    GroundPlane {}
    
    # ========================================================================
    # Viewpoints - User-calibrated for optimal viewing
    # ========================================================================
    Viewpoint {
      description "Side View"
      position 100 -1815 5
      orientation 1.0 0.014 -0.013 1.5478
      fieldOfView 0.6
    }
    
    Viewpoint {
      description "Top View"
      position 0 -89 1773
      orientation 0.671 -0.741 0.018 0.0734
      fieldOfView 0.6
    }
    
    Viewpoint {
      description "Isometric"
      position 256 -1501 971
      orientation 0.986 0.145 -0.077 0.9850
      fieldOfView 0.85
    }
    
    # ========================================================================
    # Robot Assembly - Hierarchical joint structure
    # ========================================================================
    # Root transform centers the robot vertically for better examine mode rotation
    Transform {
      translation 0 0 -400
      children [
        # Base with TouchSensor
        Transform {
          children [
            DEF Base_TouchSensor TouchSensor { }
            DEF Base Inline { url "KR_4_R600_V01_X_T_base.wrl" }
          ]
        }

        # Axis 1 (A1) - Z-axis rotation (base swivel)
        DEF A1 RobotJoint {
          jointName "A1"
          translation 0 0 187.2
          rotation 0 0 1 0
          geometryUrl ["KR_4_R600_V01_X_T_0.wrl"]
          jointLength 187.2
          hasSensor TRUE
          minAngle -2.880
          maxAngle 2.880
          showCoSys TRUE
          coSysScale 200 200 200
          children [
            # Axis 2 (A2) - Y-axis rotation (shoulder pitch)
            DEF A2 RobotJoint {
              jointName "A2"
              translation 0 0 140.9
              geometryUrl ["KR_4_R600_V01_X_T_1.wrl"]
              jointLength 140.9
              hasSensor TRUE
              minAngle -1.745
              maxAngle 2.182
              showCoSys TRUE
              coSysScale 100 100 100
              children [
                # Collision sensor for shoulder link
                DEF A2_CollisionSensor CollisionSensor {
                  translation 0 0 145
                  center 0 0 0
                  size 300 300 400
                }
                # Axis 3 (A3) - Y-axis rotation (elbow)
                DEF A3 RobotJoint {
                  jointName "A3"
                  translation 0 0 289.6
                  geometryUrl ["KR_4_R600_V01_X_T_2.wrl"]
                  jointLength 289.6
                  hasSensor TRUE
                  minAngle -3.491
                  maxAngle 0.960
                  showCoSys TRUE
                  coSysScale 100 100 100
                  children [
                    # Collision sensor for elbow link
                    DEF A3_CollisionSensor CollisionSensor {
                      translation 86 0 10
                      center 0 0 0
                      size 350 250 300
                    }
                    # Axis 4 (A4) - X-axis rotation (wrist rotation)
                    DEF A4 RobotJoint {
                      jointName "A4"
                      translation 173 0 20
                      geometryUrl ["KR_4_R600_V01_X_T_3.wrl"]
                      jointLength 173
                      hasSensor TRUE
                      minAngle -3.142
                      maxAngle 3.142
                      showCoSys TRUE
                      coSysScale 100 100 100
                      children [
                        # Collision sensor for wrist link
                        DEF A4_CollisionSensor CollisionSensor {
                          translation 67 0 0
                          center 0 0 0
                          size 270 200 200
                        }
                        # Axis 5 (A5) - Y-axis rotation (wrist roll)
                        DEF A5 RobotJoint {
                          jointName "A5"
                          translation 135.5 0 0
                          geometryUrl ["KR_4_R600_V01_X_T_4.wrl"]
                          geometryOffset 57.05 0 0
                          jointLength 192.55
                          hasSensor TRUE
                          minAngle -2.007
                          maxAngle 2.007
                          showCoSys TRUE
                          coSysScale 100 100 100
                          children [
                            # Collision sensor for wrist roll
                            DEF A5_CollisionSensor CollisionSensor {
                              translation 96 0 0
                              center 0 0 0
                              size 250 180 180
                            }
                            # Axis 6 (A6) - End effector (no sensor)
                            DEF A6 RobotJoint {
                              jointName "A6"
                              translation 57.06 0 0
                              geometryUrl ["KR_4_R600_V01_X_T_5.wrl"]
                              jointLength 0.01
                              hasSensor TRUE
                              minAngle -6.021
                              maxAngle 6.021
                              showCoSys TRUE
                              coSysScale 100 100 100
                              children [
                                # Gripper Camera Viewpoint with proximity sensor
                                DEF GripperCameraGroup Group {
                                  children [
                                    Viewpoint {
                                      description "Gripper Cam"
                                      # Positioned slightly forward from the A6 center, centered between jaws
                                      position 120 0 0 
                                      # Oriented to look forward along the X-axis (the direction of the gripper)
                                      orientation 0 1 0 1.5708 
                                      fieldOfView 1.0
                                    }
                                    # Proximity sensor for camera - detects objects in front of gripper
                                    DEF CameraProximitySensor ProximitySensor {
                                      center 120 0 0
                                      size 400 300 300
                                      enabled TRUE
                                    }
                                  ]
                                }
                                # Adapter Flange - Child of A6 (with TouchSensor as sibling)
                                DEF AdapterFlange_TouchSensor TouchSensor { }
                                DEF AdapterFlange AdapterFlanch2gripper {
                                  translation 15.8 0 0
                                  rotation 0 0 1 -1.5708
                                  scale 1 1 1
                                  children [
                                    # SCHUNK Gripper - Attached to adapter (with TouchSensor as sibling)
                                    DEF Gripper_TouchSensor TouchSensor { }
                                    DEF Gripper SchunkGripper {
                                      translation 0 5 0.5
                                      rotation 0 0 1 0
                                      scale 1000 1000 1000
                                    }
                                  ]
                                }
                                # Gripper Finger 1 - Child of A6 with collision protection
                                DEF FINGER RobotJoint {
                                  jointName "FINGER"
                                  translation 100 11 0
                                  rotation 0 1 0 1.5708
                                  jointLength 0.01
                                  hasSensor FALSE
                                  minAngle -3.1415
                                  maxAngle 3.1415
                                  showCoSys TRUE
                                  coSysScale 50 50 50
                                  children [
                                    # Collision sensor for finger 1
                                    DEF Finger1_CollisionSensor CollisionSensor {
                                      translation 25 0 0
                                      center 0 0 0
                                      size 150 100 100
                                    }
                                    Transform {
                                      scale 1000 1000 1000
                                      children [
                                        Collision {
                                          collide TRUE
                                          children [
                                            Inline {
                                              url ["prizmfinger.wrl"]
                                            }
                                          ]
                                        }
                                      ]
                                    }
                                  ]
                                }
                                # Gripper Finger 2 (Mirrored) - Child of A6 with collision protection
                                DEF FINGER2 RobotJoint {
                                  jointName "FINGER2"
                                  translation 100 -11 0
                                  rotation 0 1 0 1.5708
                                  jointLength 0.01
                                  hasSensor FALSE
                                  minAngle -3.1415
                                  maxAngle 3.1415
                                  showCoSys TRUE
                                  coSysScale 50 50 50
                                  children [
                                    # Collision sensor for finger 2
                                    DEF Finger2_CollisionSensor CollisionSensor {
                                      translation 25 0 0
                                      center 0 0 0
                                      size 150 100 100
                                    }
                                    Transform {
                                      scale 1000 1000 1000
                                      children [
                                        Collision {
                                          collide TRUE
                                          children [
                                            Inline {
                                              url ["prizmfinger.wrl"]
                                            }
                                          ]
                                        }
                                      ]
                                    }
                                  ]
                                }
                              ]
                            }
                          ]
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          ]
        }
      ]
    }
    
    # Animation Timer (disabled)
    DEF AnimationTimer TimeSensor {
      cycleInterval 20.0
      loop FALSE
      enabled FALSE
    }

    # Joint Interpolators (Enhanced Keyframes for Pick from Floor and Place at Top)
    # A2 (Shoulder) Pitch Sequence - Enhanced visibility with dramatic motion
    DEF A2_Interp OrientationInterpolator {
      key [ 0.0, 0.05, 0.12, 0.20, 0.25, 0.30, 0.40, 0.50, 0.60, 0.70, 0.75, 0.85, 0.95, 1.0 ]
      keyValue [
        0 1 0 0.0,     # Home Position (neutral)
        0 1 0 0.3,     # Start moving forward
        0 1 0 0.8,     # Approach floor area
        0 1 0 1.4,     # Reach deep down to floor (more dramatic)
        0 1 0 1.4,     # Hold at floor for grip
        0 1 0 0.9,     # Start lift motion
        0 1 0 0.2,     # Rise with object
        0 1 0 -0.4,    # Move higher
        0 1 0 -0.9,    # Approach top position (more dramatic)
        0 1 0 -1.3,    # Extend far to top placement
        0 1 0 -1.3,    # Hold at top for release
        0 1 0 -0.6,    # Retract from top
        0 1 0 0.2,     # Return path high
        0 1 0 0.0      # Return to home
      ]
    }

    # A3 (Elbow) Sequence - Enhanced coordination with shoulder
    DEF A3_Interp OrientationInterpolator {
      key [ 0.0, 0.05, 0.12, 0.20, 0.25, 0.30, 0.40, 0.50, 0.60, 0.70, 0.75, 0.85, 0.95, 1.0 ]
      keyValue [
        0 1 0 1.5,     # Home Position (folded)
        0 1 0 1.0,     # Start extending
        0 1 0 0.4,     # Extend for approach
        0 1 0 -0.3,    # Fully extend to reach floor (dramatic)
        0 1 0 -0.3,    # Hold extended at floor
        0 1 0 0.5,     # Start folding for lift
        0 1 0 1.3,     # Fold more during lift
        0 1 0 1.8,     # Maximum fold while carrying
        0 1 0 1.2,     # Extend toward top
        0 1 0 0.3,     # Fully extend to top (dramatic reach)
        0 1 0 0.3,     # Hold at top
        0 1 0 0.8,     # Retract after release
        0 1 0 1.5,     # Return to folded
        0 1 0 1.5      # Home Position
      ]
    }
    
    # A4 (Wrist Rotation) - Enhanced gripper orientation changes
    DEF A4_Interp OrientationInterpolator {
      key [ 0.0, 0.10, 0.20, 0.25, 0.40, 0.60, 0.70, 0.75, 0.90, 1.0 ]
      keyValue [
        1 0 0 0.0,     # Home orientation (neutral)
        1 0 0 0.4,     # Start tilting down
        1 0 0 0.9,     # Tilt far down for floor pick (more visible)
        1 0 0 0.9,     # Hold floor orientation
        1 0 0 0.3,     # Adjust during lift
        1 0 0 -0.5,    # Tilt up for top placement (dramatic)
        1 0 0 -0.8,    # Maximum tilt for release
        1 0 0 -0.8,    # Hold top orientation
        1 0 0 -0.2,    # Start returning
        1 0 0 0.0      # Home orientation
      ]
    }
    
    # A5 (Wrist Pitch) - Enhanced gripper angle adjustments
    DEF A5_Interp OrientationInterpolator {
      key [ 0.0, 0.10, 0.20, 0.25, 0.40, 0.60, 0.70, 0.75, 0.90, 1.0 ]
      keyValue [
        0 1 0 0.0,     # Home position
        0 1 0 -0.3,    # Start angling down
        0 1 0 -0.7,    # Angle deeper down for pick (more visible)
        0 1 0 -0.7,    # Hold pick angle
        0 1 0 -0.2,    # Adjust during lift
        0 1 0 0.4,     # Angle for placement
        0 1 0 0.8,     # Angle more for release (more visible)
        0 1 0 0.8,     # Hold release angle
        0 1 0 0.2,     # Return transition
        0 1 0 0.0      # Home position
      ]
    }
    
    # A6 (End Effector) - Enhanced gripper open/close simulation
    DEF A6_Interp OrientationInterpolator {
      key [ 0.0, 0.18, 0.22, 0.27, 0.65, 0.68, 0.73, 0.95, 1.0 ]
      keyValue [
        1 0 0 0.8,     # Wide open gripper at start (very visible)
        1 0 0 0.8,     # Stay open approaching floor
        1 0 0 0.5,     # Start closing
        1 0 0 0.0,     # Fully closed - gripping object
        1 0 0 0.0,     # Hold object firmly
        1 0 0 0.3,     # Start opening
        1 0 0 0.9,     # Wide open to release (very visible)
        1 0 0 0.9,     # Hold open after release
        1 0 0 0.8      # Return to open home position
      ]
    }

    # A1 (Base) Swivel Sequence - Enhanced dramatic rotation
    DEF A1_Interp OrientationInterpolator {
      key [ 0.0, 0.08, 0.28, 0.33, 0.38, 0.50, 0.62, 0.67, 0.72, 0.88, 0.95, 1.0 ]
      keyValue [
        0 0 1 0.0,     # Home Position (0°)
        0 0 1 0.0,     # Hold at pick location
        0 0 1 0.0,     # Pick complete - prepare to rotate
        0 0 1 0.2,     # Start rotation slowly
        0 0 1 0.6,     # Accelerate rotation
        0 0 1 1.8,     # Rotate to place position (103° - more dramatic)
        0 0 1 1.8,     # Hold steady at place position
        0 0 1 1.8,     # Place complete
        0 0 1 1.2,     # Start return rotation
        0 0 1 0.4,     # Continue returning
        0 0 1 0.1,     # Slow down near home
        0 0 1 0.0      # Home Position
      ]
    }
  ]
}

# Animation Routes
ROUTE AnimationTimer.fraction_changed TO A1_Interp.set_fraction
ROUTE AnimationTimer.fraction_changed TO A2_Interp.set_fraction
ROUTE AnimationTimer.fraction_changed TO A3_Interp.set_fraction
ROUTE AnimationTimer.fraction_changed TO A4_Interp.set_fraction
ROUTE AnimationTimer.fraction_changed TO A5_Interp.set_fraction
ROUTE AnimationTimer.fraction_changed TO A6_Interp.set_fraction

ROUTE A1_Interp.value_changed TO A1.set_rotation
ROUTE A2_Interp.value_changed TO A2.set_rotation
ROUTE A3_Interp.value_changed TO A3.set_rotation
ROUTE A4_Interp.value_changed TO A4.set_rotation
ROUTE A5_Interp.value_changed TO A5.set_rotation
ROUTE A6_Interp.value_changed TO A6.set_rotation

# Manual Control Routes
ROUTE A1.rotation_changed TO A1_AxisConverter.rotation_in
ROUTE A1_AxisConverter.rotation_out TO A1.set_rotation
ROUTE A2.rotation_changed TO A2.set_rotation
ROUTE A3.rotation_changed TO A3.set_rotation
ROUTE A4.rotation_changed TO A4_AxisConverter.rotation_in
ROUTE A4_AxisConverter.rotation_out TO A4.set_rotation
ROUTE A5.rotation_changed TO A5.set_rotation
ROUTE A6.rotation_changed TO A6_AxisConverter.rotation_in
ROUTE A6_AxisConverter.rotation_out TO A6.set_rotation